import*as e from"@wordpress/interactivity";var t={d:(e,n)=>{for(var c in n)t.o(n,c)&&!t.o(e,c)&&Object.defineProperty(e,c,{enumerable:!0,get:n[c]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const n=(c={getContext:()=>e.getContext,getServerState:()=>e.getServerState,store:()=>e.store,withSyncEvent:()=>e.withSyncEvent},o={},t.d(o,c),o);var c,o;function s(e){return 250<=e?"250+":e}function a(e,t,n){const c=n.find((e=>e.value===t));return c?c[e]:null}const{state:r,actions:l}=(0,n.store)("prc-platform/facets-context-provider",{state:{get choices(){const e=(0,n.getContext)(),{facetSlug:t,limit:c,facetType:o}=e;return t&&r.facets[t]?"dropdown"===o?(console.log("construct dropdown choices for ",t,r.facets[t],{...e}),[...r.facets[t].choices].sort(((e,t)=>{const n=Number(e.label),c=Number(t.label);return isNaN(n)||isNaN(c)?t.label.localeCompare(e.label):c-n}))):[...r.facets[t].choices].sort(((e,n)=>{const c=r.facets[t].selected.includes(e.value),o=r.facets[t].selected.includes(n.value);return c!==o?o-c:n.count-e.count})).slice(0,c):[]},get expandedChoices(){const e=(0,n.getContext)(),{facetSlug:t}=e;return r.facets[t]?r.facets[t].choices.filter((e=>{const n=r.facets[t].selected.includes(e.value),c=r.choices.includes(e);return!n&&!c})).sort(((e,t)=>t.count-e.count)):[]},get hasChoices(){const e=(0,n.getContext)(),{facetSlug:t}=e,{facets:c}=r;return c[t].choices.length>0},get hasSelections(){const e=(0,n.getContext)(),{facetSlug:t}=e,{facets:c}=r;return c[t].selected.length>0},get hasExpandedChoices(){return r.expandedChoices&&r.expandedChoices.length>0},get isExpanded(){const e=(0,n.getContext)(),{expanded:t}=e;return t},get isInputChecked(){const e=(0,n.getContext)(),{choice:t,facetSlug:c}=e,{value:o}=t,{facets:s}=r;return s[c].selected.includes(o)},get isInputDisabled(){const e=(0,n.getContext)(),{choice:t}=e,{value:c,label:o,facetSlug:s}=t;return 0===a("count",c,r.facets[s].choices)},get isInputError(){return!1},get isInputSuccess(){return!1},get isInputRequired(){return!1},get isInputProcessing(){return!1},get isInputHidden(){return!1},get isInputReadOnly(){return!1},get inputName(){const e=(0,n.getContext)(),{choice:t}=e;return t.slug},get inputLabel(){const e=(0,n.getContext)(),{choice:t}=e,{value:c,label:o,facetSlug:l}=t;return`${o} (${s(a("count",c,r.facets[l].choices))})`},get inputId(){const e=(0,n.getContext)(),{choice:t}=e,{slug:c,term_id:o}=t;return`facet_${c}_${o}`},get inputValue(){const e=(0,n.getContext)(),{choice:t}=e;return t.value},get inputPlaceholder(){const e=(0,n.getContext)(),{placeholder:t,facetType:c,facetSlug:o}=e;let s=`Select ${t}`;return"dropdown"===c&&r.facets[o].selected.length>0&&(s=r.facets[o].selected[0].replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))),s},get isSelected(){const e=(0,n.getContext)(),{choice:t}=e,{tokens:c}=r,{value:o}=t;return c.includes(o)},get isOpen(){const{expanded:e}=(0,n.getContext)();return e},get inputOptions(){const e=(0,n.getContext)(),{facetSlug:t,facetType:c,searchTerm:o}=e,{choices:a}=(0,n.getServerState)().facets[t];let r=a;if(o&&o.length>0&&a){const e=a.filter((e=>e.label.toLowerCase().includes(o.toLowerCase())));r=e.length>0?e:a}return r.map((e=>({value:e.value,label:`${e.label} (${s(e.count)})`})))},get hasValue(){const e=(0,n.getContext)(),{facetSlug:t}=e,{selected:c}=r.facets[t];return c.length>0},get hasClearIcon(){return!1},get activeIndex(){const e=(0,n.getContext)(),{activeIndex:t}=e;return t||0}},actions:{clearFacet:()=>{const{facetSlug:e}=(0,n.getContext)();l.onClear(e)},*onInputMouseEnter(){const e=(0,n.getContext)(),{facetSlug:t,value:c,selected:o}=e,s={...o||[],[c]:c},a=l.constructNewUrl(s);yield l.prefetch(a)},onInputMouseLeave:(0,n.withSyncEvent)((e=>{})),onInputFocus:(0,n.withSyncEvent)((e=>{const t=(0,n.getContext)(),{facetType:c}=t;"dropdown"===c&&(t.expanded=!t.expanded)})),onInputBlur:(0,n.withSyncEvent)((e=>{let t=!1;if(!t){t=!0;const e=(0,n.getContext)(),{facetType:c}=e;"dropdown"===c&&setTimeout((()=>{e.expanded=!1,t=!1}),150)}})),onInputKeyDown:(0,n.withSyncEvent)((e=>{e.preventDefault();const t=(0,n.getContext)();if("dropdown"===t.facetType&&"Enter"===e.key){const{activeIndex:e,facetSlug:n}=t,{inputOptions:c,selected:o}=r,{value:s}=c[e];o[n]=[s],setTimeout((()=>{t.expanded=!1}),150)}})),onInputKeyUp:(0,n.withSyncEvent)((e=>{const t=(0,n.getContext)(),{expanded:c,facetType:o}=t;"dropdown"===o&&(t.searchTerm=e.target.value,c||(t.expanded=!0),40!==e.keyCode||"ArrowDown"!==e.key?38!==e.keyCode||"ArrowUp"!==e.key?"Escape"===e.key&&(t.expanded=!1):l.moveThroughChoices(-1,e.target):l.moveThroughChoices(1,e.target))})),moveThroughChoices:(e,t)=>{const{inputOptions:c}=r,{activeIndex:o}=(0,n.getContext)();let s=null;s=null===o||isNaN(o)?0:o+e,s<0&&(s=c.length-1),s>=c.length&&(s=0);const a=c[s].value,l=t.parentElement.parentElement.querySelector(".wp-block-prc-block-form-input-select__list"),u=l.querySelector(`[data-ref-value="${a}"]`);if(u){const e=l.querySelector(".is-selected");e&&e.classList.remove("is-selected"),u.classList.add("is-selected"),u.scrollIntoView({block:"nearest"})}(0,n.getContext)().activeIndex=s},onInputOptionClick:(0,n.withSyncEvent)((e=>{const t=(0,n.getContext)(),{facetSlug:c,choice:o}=t,{selected:s}=r,{value:a}=o;s[c]=[a],console.log("onInputOptionClick",{...t},a,s)})),onInputCheckboxClick:(0,n.withSyncEvent)((e=>{const t=(0,n.getContext)(),{choice:c,facetSlug:o}=t,{selected:s}=r,{value:a,type:l}=c;r.isInputDisabled||(s[o]&&0!==s[o].length?s[o].includes(a)?s[o]=s[o].filter((e=>e!==a)):s[o]="radio"===l?[a]:[...s[o],a]:s[o]=[a])})),onExpand:()=>{const e=(0,n.getContext)();e.expanded=!e.expanded},onCollapse:()=>{const e=(0,n.getContext)();let t=!1;t||(t=!0,setTimeout((()=>{e.expanded=!1,t=!1}),150))}},callbacks:{onExpand:()=>{const e=(0,n.getContext)(),{expanded:t}=e;e.expandedLabel=t?"- Less":"+ More"}}});
//# sourceMappingURL=view.js.map
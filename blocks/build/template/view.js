import{getContext as e,getServerState as t,store as c,withSyncEvent as n}from"@wordpress/interactivity";function s(e){return 250<=e?"250+":e}function o(e,t,c){const n=c.find(e=>e.value===t);return n?n[e]:null}const{state:a,actions:l}=c("prc-platform/facets-context-provider",{state:{get choices(){const t=e(),{facetSlug:c,limit:n,facetType:s}=t;return c&&a.facets[c]?"dropdown"===s?[...a.facets[c].choices].sort((e,t)=>{const c=Number(e.label),n=Number(t.label);return isNaN(c)||isNaN(n)?t.label.localeCompare(e.label):n-c}):[...a.facets[c].choices].sort((e,t)=>{const n=a.facets[c].selected.includes(e.value),s=a.facets[c].selected.includes(t.value);return n!==s?s-n:t.count-e.count}).slice(0,n):[]},get expandedChoices(){const t=e(),{facetSlug:c}=t;return a.facets[c]?a.facets[c].choices.filter(e=>{const t=a.facets[c].selected.includes(e.value),n=a.choices.includes(e);return!t&&!n}).sort((e,t)=>t.count-e.count):[]},get hasChoices(){const t=e(),{facetSlug:c}=t,{facets:n}=a;return n[c].choices.length>0},get hasSelections(){const t=e(),{facetSlug:c}=t,{facets:n}=a;return n[c].selected.length>0},get hasExpandedChoices(){return a.expandedChoices&&a.expandedChoices.length>0},get isExpanded(){const t=e(),{expanded:c}=t;return c},get isInputChecked(){const t=e(),{choice:c,facetSlug:n}=t,{value:s}=c,{facets:o}=a;return o[n].selected.includes(s)},get isInputDisabled(){const t=e(),{choice:c}=t,{value:n,label:s,facetSlug:l}=c;return 0===o("count",n,a.facets[l].choices)},get isInputError(){return!1},get isInputSuccess(){return!1},get isInputRequired(){return!1},get isInputProcessing(){return!1},get isInputHidden(){return!1},get isInputReadOnly(){return!1},get inputName(){const t=e(),{choice:c}=t;return c.slug},get inputLabel(){const t=e(),{choice:c}=t,{value:n,label:l,facetSlug:r}=c;return`${l} (${s(o("count",n,a.facets[r].choices))})`},get inputId(){const t=e(),{choice:c}=t,{slug:n,term_id:s}=c;return`facet_${n}_${s}`},get inputValue(){const t=e(),{choice:c}=t;return c.value},get inputPlaceholder(){const t=e(),{placeholder:c,facetType:n,facetSlug:s}=t;let o=`Select ${c}`;return"dropdown"===n&&a.facets[s].selected.length>0&&(o=a.facets[s].selected[0].toString().replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())),o},get isSelected(){const t=e(),{choice:c}=t,{tokens:n}=a,{value:s}=c;return n.includes(s)},get isOpen(){const{expanded:t}=e();return t},get inputOptions(){const c=e(),{facetSlug:n,facetType:o,searchTerm:a}=c,{choices:l}=t().facets[n];let r=l;if(a&&a.length>0&&l){const e=l.filter(e=>e.label.toLowerCase().includes(a.toLowerCase()));r=e.length>0?e:l}return r.map(e=>({value:e.value,label:`${e.label} (${s(e.count)})`}))},get hasValue(){const t=e(),{facetSlug:c}=t,{selected:n}=a.facets[c];return n.length>0},get hasClearIcon(){return!1},get activeIndex(){const t=e(),{activeIndex:c}=t;return c||0}},actions:{clearFacet:()=>{const{facetSlug:t}=e();l.onClear(t)},*onInputMouseEnter(){const t=e(),{facetSlug:c,value:n,selected:s}=t,o={...s||[],[n]:n},a=l.constructNewUrl(o);yield l.prefetch(a)},onInputMouseLeave:n(e=>{}),onInputFocus:n(t=>{const c=e(),{facetType:n}=c;"dropdown"===n&&(c.expanded=!c.expanded)}),onInputBlur:n(t=>{let c=!1;if(!c){c=!0;const t=e(),{facetType:n}=t;"dropdown"===n&&setTimeout(()=>{t.expanded=!1,c=!1},150)}}),onInputKeyDown:n(t=>{t.preventDefault();const c=e();if("dropdown"===c.facetType&&"Enter"===t.key){const{activeIndex:e,facetSlug:t}=c,{inputOptions:n,selected:s}=a,{value:o}=n[e];s[t]=[o],setTimeout(()=>{c.expanded=!1},150)}}),onInputKeyUp:n(t=>{const c=e(),{expanded:n,facetType:s}=c;"dropdown"===s&&(c.searchTerm=t.target.value,n||(c.expanded=!0),40!==t.keyCode||"ArrowDown"!==t.key?38!==t.keyCode||"ArrowUp"!==t.key?"Escape"===t.key&&(c.expanded=!1):l.moveThroughChoices(-1,t.target):l.moveThroughChoices(1,t.target))}),onDropdownArrowClick:n(t=>{const c=e(),{facetType:n}=c;"dropdown"===n&&(c.expanded=!c.expanded)}),moveThroughChoices:(t,c)=>{const{inputOptions:n}=a,{activeIndex:s}=e();let o=null;o=null===s||isNaN(s)?0:s+t,o<0&&(o=n.length-1),o>=n.length&&(o=0);const l=n[o].value,r=c.parentElement.parentElement.querySelector(".wp-block-prc-block-form-input-select__list"),u=r.querySelector(`[data-ref-value="${l}"]`);if(u){const e=r.querySelector(".is-selected");e&&e.classList.remove("is-selected"),u.classList.add("is-selected"),u.scrollIntoView({block:"nearest"})}e().activeIndex=o},onInputOptionClick:n(t=>{const c=e(),{facetSlug:n,choice:s}=c,{selected:o}=a,{value:l}=s;o[n]=[l]}),onInputCheckboxClick:n(t=>{const c=e(),{choice:n,facetSlug:s}=c,{selected:o}=a,{value:l,type:r}=n;a.isInputDisabled||(o[s]&&0!==o[s].length?o[s].includes(l)?o[s]=o[s].filter(e=>e!==l):o[s]="radio"===r?[l]:[...o[s],l]:o[s]=[l])}),onExpand:()=>{const t=e();t.expanded=!t.expanded},onCollapse:()=>{const t=e();let c=!1;c||(c=!0,setTimeout(()=>{t.expanded=!1,c=!1},150))}},callbacks:{onExpand:()=>{const t=e(),{expanded:c}=t;t.expandedLabel=c?"- Less":"+ More"}}});
//# sourceMappingURL=view.js.map